<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <link rel="stylesheet" href="style.css" />
    <title id="title1">Test</title>
</head>
<body>
	<h1 id="title2">CarPDD</h1>
	<div class="divcontainer">
		<div class="divcol">         			
			<h2>DEBUG: CURR DATA</h2>
			<div class="showhide"><a class="showhidebutton"><img class="showimg" /></a></div>
			<div class="divcont">
                <p id="currpostest" style="font-family:courier;">No Data!</p>
            </div>
        </div>
    </div>	 
    <div class="divcontainer">
    <div class="divcol">         			
        <h2>PDD</h2>
        <div class="showhide"><a class="showhidebutton"><img class="showimg" /></a></div>
        <div class="divcont">
            <p id="curr" style="font-family:courier;">No Data!</p>
        </div>
    </div>
    </div>	
	<div class="divcontainer">
		<div class="divcol">         			
			<h2>SPEED CTRL</h2>
			<div class="showhide"><a class="showhidebutton"><img class="showimg" /></a></div>
			<div class="divcont">
                <p id="spdlimits" style="font-family:courier;">No Data!</p>
            </div>
        </div>
    </div>
    
    <script>
        var objs = document.getElementsByClassName("showhidebutton");
	
        for (i = 0; i < objs.length; i++)
        {
            objs[i].addEventListener("click", showHideBox);		
        }
        
        var lat;
        var lon;
        var alt;
        var hdg;
        var spd;
        var datacnt = 0;
        
        var spdlmts = [ 30, 50, 60, 70, 80, 100, 120 ];
        var tolerancespdlmt = 5;
        
        getpos();
                
        function getpos()
        {            
            if (navigator.geolocation) 
            {
                navigator.geolocation.watchPosition(showPosition, errorPosition);
            } 
            else 
            {
                testout.innerHTML = "Geolocation is not supported by this browser.";
            }
        }
        
        function showPosition(position) 
        {
            datacnt += 1;
            
            lat = position.coords.latitude;
            lon = position.coords.longitude;
            alt = position.coords.altitude;
            hdg = position.coords.heading;
            spd = position.coords.speed;

            display();
        }
        
        function display()
        {
            var testout = document.getElementById("currpostest");
            testout.innerHTML = "Cnt: " + datacnt + "<br>";
            testout.innerHTML += "Lat: " + lat + "<br>";
            testout.innerHTML += "Lon: " + lon + "<br>";
            testout.innerHTML += "Alt: " + alt + "<br>";
            testout.innerHTML += "Hdg: " + hdg + "<br>";
            testout.innerHTML += "Spd: " + spd + "<br>";
            
            document.getElementById("spdlimits").innerHTML = "";
            for (var i = 0; i < spdlmts.length; i++)
            {
                document.getElementById("spdlimits").innerHTML += `<div  id="limit${spdlmts[i]}" style="width:50%;border:1px solid gray;margin:auto;padding:5px;border-radius:5px;text-align:center;font-size:2em;">${spdlmts[i]} km/h</div> `;
                
                if (spd <= spdlmts[i])
                {
                    document.getElementById("limit" + spdlmts[i]).style.background = "lime";
                }
                else if (spd > spdlmts[i] + tolerancespdlmt)
                {
                    document.getElementById("limit" + spdlmts[i]).style.background = "tomato";
                }
                else
                {
                    document.getElementById("limit" + spdlmts[i]).style.background = "gold";
                }
                
                var currvals = "";
                if (spd)
                { currvals += `<span style="font-size:2em;">${Math.trunc(spd)} km/h </span><br>`; }
                else
                { currvals += "<span style='font-size:2em;color:red;'> XXXX km/h</span><br>"; }
                
                var curralt;
                if (alt)
                { currvals += `<span style="font-size:2em;">${Math.trunc(alt)} m </span><br>`; }
                else
                { currvals += "<span style='font-size:2em;color:red;'> XXXX m</span><br>"; }
                
                var currhdg;
                if (hdg)
                { currvals += `<span style="font-size:2em;">${Math.trunc(hdg)} ° </span><br>`; }
                else
                { currvals += "<span style='font-size:2em;color:red;'> XXXX °</span><br>"; }
                
                document.getElementById("curr").innerHTML = currvals;
            }
        }
        
        function errorPosition()
        {
            document.getElementById("currpostest").innerHTML = "No Data!";
            
            document.getElementById("spdlimits").innerHTML = "No Data!";
            
            document.getElementById("curr").innerHTML = "No Data!";
        }
        
        function showHideBox()
        {
            this.parentElement.nextElementSibling.classList.toggle("hidden");
            if (this.parentElement.nextElementSibling.classList.contains("hidden"))
            {
                this.children[0].classList.replace("hideimg", "showimg");
            }
            else
            {
                this.children[0].classList.replace("showimg", "hideimg");
            }
        }
    </script>
</body>
</html>